local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Configurações de Suavidade e Distância
local Smoothness = 0.18 
local DistanciaTP = 3.2 

-- Variáveis de Controle
local aimbotLigado = false
local espLigado = false
local killAuraLigado = false
local menuVisivel = true
local alvoFixo = nil

-- ==========================================
-- INTERFACE (YELZY HUB)
-- ==========================================
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "YelzyHub_V17"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 230, 0, 200)
mainFrame.Position = UDim2.new(0.1, 0, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true

local corner = Instance.new("UICorner", mainFrame)
local stroke = Instance.new("UIStroke", mainFrame)
stroke.Color = Color3.fromRGB(255, 0, 0)
stroke.Thickness = 2

local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "Yelzy Hub"
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundTransparency = 1
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18

local container = Instance.new("Frame", mainFrame)
container.Size = UDim2.new(1, 0, 1, -40)
container.Position = UDim2.new(0, 0, 0, 40)
container.BackgroundTransparency = 1

local layout = Instance.new("UIListLayout", container)
layout.Padding = UDim.new(0, 10)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function criarBotao(nome)
    local btn = Instance.new("TextButton", container)
    btn.Size = UDim2.new(0.9, 0, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.Text = nome
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 14
    Instance.new("UICorner", btn)
    local s = Instance.new("UIStroke", btn)
    s.Thickness = 0
    s.Color = Color3.fromRGB(255, 0, 0)
    return btn, s
end

local btnAim, sAim = criarBotao("Aimbot Punch and skill")
local btnEsp, sEsp = criarBotao("Esp Players")
local btnKill, sKill = criarBotao("Tp To Player atack (kill aura)")

local function atualizarBotao(btn, s, cond)
    s.Thickness = cond and 2 or 0
    btn.BackgroundColor3 = cond and Color3.fromRGB(60, 0, 0) or Color3.fromRGB(30, 30, 30)
end

-- ==========================================
-- LÓGICA DE ALVO
-- ==========================================

local function validarAlvo(char)
    return char and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0 and char:FindFirstChild("HumanoidRootPart")
end

local function buscarNovoAlvo()
    local alvo, menorDist = nil, math.huge
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and validarAlvo(p.Character) then
            local dist = (LocalPlayer.Character.HumanoidRootPart.Position - p.Character.HumanoidRootPart.Position).Magnitude
            if dist < menorDist then
                menorDist = dist
                alvo = p.Character
            end
        end
    end
    return alvo
end

-- ==========================================
-- LOOPS DE EXECUÇÃO
-- ==========================================

RunService.RenderStepped:Connect(function()
    -- ESP PLAYERS
    if espLigado then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character then
                local h = p.Character:FindFirstChild("YelzyHighlight") or Instance.new("Highlight", p.Character)
                h.Name = "YelzyHighlight"
                h.FillColor = Color3.new(1, 0, 0)
                h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
            end
        end
    end

    -- LÓGICA PRINCIPAL
    if aimbotLigado or killAuraLigado then
        -- Trava no alvo até ele morrer
        if not alvoFixo or not validarAlvo(alvoFixo) then
            alvoFixo = buscarNovoAlvo()
        end

        if alvoFixo then
            local root = alvoFixo.HumanoidRootPart
            
            -- Aimbot: Apenas move a câmera (Não trava o movimento do personagem)
            local objetivoCFrame = CFrame.new(Camera.CFrame.Position, root.Position)
            Camera.CFrame = Camera.CFrame:Lerp(objetivoCFrame, Smoothness)

            -- Kill Aura: Move o personagem e ataca
            if killAuraLigado then
                local meuRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if meuRoot then
                    -- Teleporte apenas se o Kill Aura estiver ligado
                    meuRoot.CFrame = root.CFrame * CFrame.new(0, 0, DistanciaTP)
                    
                    -- Ataque Automático
                    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                    task.wait(0.01)
                    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
                end
            end
        end
    else
        alvoFixo = nil
    end
end)

-- ==========================================
-- EVENTOS
-- ==========================================

btnAim.MouseButton1Click:Connect(function()
    aimbotLigado = not aimbotLigado
    atualizarBotao(btnAim, sAim, aimbotLigado)
end)

btnEsp.MouseButton1Click:Connect(function()
    espLigado = not espLigado
    atualizarBotao(btnEsp, sEsp, espLigado)
    if not espLigado then
        for _, p in pairs(Players:GetPlayers()) do
            if p.Character and p.Character:FindFirstChild("YelzyHighlight") then
                p.Character.YelzyHighlight:Destroy()
            end
        end
    end
end)

btnKill.MouseButton1Click:Connect(function()
    killAuraLigado = not killAuraLigado
    atualizarBotao(btnKill, sKill, killAuraLigado)
    -- Ativa aimbot para ajudar nas skills durante o Kill Aura
    if killAuraLigado then
        aimbotLigado = true
        atualizarBotao(btnAim, sAim, true)
    end
end)

-- Botão Y (Mobile Minimizar)
local yBtn = Instance.new("TextButton", screenGui)
yBtn.Size = UDim2.new(0, 45, 0, 45)
yBtn.Position = UDim2.new(0, 10, 0, 10)
yBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
yBtn.Text = "Y"
yBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", yBtn).CornerRadius = UDim.new(1, 0)

yBtn.MouseButton1Click:Connect(function()
    menuVisivel = not menuVisivel
    mainFrame.Visible = menuVisivel
end)