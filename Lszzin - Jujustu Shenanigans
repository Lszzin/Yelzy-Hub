local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local PlaceId = game.PlaceId

-- Variáveis de Estado
local aimbotLigado = false
local espLigado = false
local killAuraLigado = false
local menuVisivel = true
local alvoTravado = nil 

-- IDs DOS JOGOS
local ID_JUJUTSU = 9391468976
local ID_FLICK = 136801880565837
local ID_STRONGEST = 10449761463

local eJujutsu = (PlaceId == ID_JUJUTSU)
local eFlick = (PlaceId == ID_FLICK)
local eStrongest = (PlaceId == ID_STRONGEST)

-- ==========================================
-- INTERFACE (ESTILO JUJUTSU)
-- ==========================================
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "YelzyHub_V13"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 240, 0, 180)
mainFrame.Position = UDim2.new(0.1, 0, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(200, 0, 0)
mainFrame.Active = true
mainFrame.Draggable = true

local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 14

-- Título Dinâmico
if eJujutsu then title.Text = "Yelzy Hub - Jujutsu Shenanigans"
elseif eStrongest then title.Text = "Yelzy Hub - The Strongest Battlegrounds"
else title.Text = "Yelzy Hub - [FPS] Flick" end

local list = Instance.new("UIListLayout", mainFrame)
list.Padding = UDim.new(0, 5)
list.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function criarBotao(nome)
    local btn = Instance.new("TextButton", mainFrame)
    btn.Size = UDim2.new(0.9, 0, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.Text = nome
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 16
    local stroke = Instance.new("UIStroke", btn)
    stroke.Thickness = 0
    stroke.Color = Color3.fromRGB(0, 255, 0)
    return btn, stroke
end

-- Configuração dos Botões por Jogo
local textoAimbot = (eFlick or eStrongest) and "Aimbot + AutoShoot" or "Aimbot Skill and Punches"
local btnAim, strokeAim = criarBotao(textoAimbot)
local btnEsp, strokeEsp = criarBotao("Esp Players")
local btnKill, strokeKill

if eJujutsu or eStrongest then
    btnKill, strokeKill = criarBotao("Kill aura + Aimbot")
end

local function alternarVisual(btn, stroke, ativo)
    btn.Size = ativo and UDim2.new(0.95, 0, 0, 45) or UDim2.new(0.9, 0, 0, 40)
    stroke.Thickness = ativo and 2 or 0
end

-- ==========================================
-- LÓGICA CORE (VISIBILIDADE E TRAVA)
-- ==========================================

local function estaVisivel(p_char)
    if not p_char or not p_char:FindFirstChild("HumanoidRootPart") then return false end
    local rayParam = RaycastParams.new()
    rayParam.FilterType = Enum.RaycastFilterType.Exclude
    rayParam.FilterDescendantsInstances = {LocalPlayer.Character, p_char, Camera}
    local direcao = p_char.HumanoidRootPart.Position - Camera.CFrame.Position
    local resultado = workspace:Raycast(Camera.CFrame.Position, direcao, rayParam)
    return resultado == nil
end

local function obterAlvo()
    -- Lógica Flick/Strongest: Não solta o alvo até morrer ou sumir
    if alvoTravado and alvoTravado:FindFirstChild("Humanoid") and alvoTravado.Humanoid.Health > 0 and estaVisivel(alvoTravado) then
        return alvoTravado
    end

    local novoAlvo, menorDist = nil, math.huge
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character:FindFirstChild("Humanoid") then
            if p.Character.Humanoid.Health > 0 and estaVisivel(p.Character) then
                local dist = (LocalPlayer.Character.HumanoidRootPart.Position - p.Character.HumanoidRootPart.Position).Magnitude
                if dist < menorDist then
                    menorDist = dist
                    novoAlvo = p.Character
                end
            end
        end
    end
    alvoTravado = novoAlvo
    return novoAlvo
end

-- ==========================================
-- LOOPS DE FUNCIONAMENTO
-- ==========================================

RunService.RenderStepped:Connect(function()
    -- ESP
    if espLigado then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character then
                local h = p.Character:FindFirstChild("EspHighlight") or Instance.new("Highlight", p.Character)
                h.Name = "EspHighlight"
                h.FillColor = Color3.new(1, 0, 0)
                h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
            end
        end
    end

    -- Aimbot Estilo FPS (Trava e não solta)
    if aimbotLigado then
        local alvo = obterAlvo()
        if alvo and alvo:FindFirstChild("HumanoidRootPart") then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, alvo.HumanoidRootPart.Position)
            
            -- Auto-Shoot para jogos de combate/tiro
            if eFlick or eStrongest then
                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                task.wait(0.02)
                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            end
        end
    else
        alvoTravado = nil
    end
end)

-- Kill Aura (Teleporte para Jujutsu e Strongest)
task.spawn(function()
    while true do
        task.wait()
        if killAuraLigado and (eJujutsu or eStrongest) then
            local alvo = obterAlvo()
            if alvo and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                LocalPlayer.Character.HumanoidRootPart.CFrame = alvo.HumanoidRootPart.CFrame
                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                task.wait(0.01)
                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            end
        end
    end
end)

-- Botão Minimizar (Mobile)
local minBtn = Instance.new("TextButton", screenGui)
minBtn.Size = UDim2.new(0, 40, 0, 40)
minBtn.Position = UDim2.new(0, 5, 0, 50)
minBtn.Text = "Y"
minBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
Instance.new("UICorner", minBtn)
minBtn.MouseButton1Click:Connect(function()
    menuVisivel = not menuVisivel
    mainFrame.Visible = menuVisivel
end)

-- Eventos de Clique
btnAim.MouseButton1Click:Connect(function() aimbotLigado = not aimbotLigado alternarVisual(btnAim, strokeAim, aimbotLigado) end)
btnEsp.MouseButton1Click:Connect(function() espLigado = not espLigado alternarVisual(btnEsp, strokeEsp, espLigado) end)
if btnKill then
    btnKill.MouseButton1Click:Connect(function() killAuraLigado = not killAuraLigado alternarVisual(btnKill, strokeKill, killAuraLigado) end)
end